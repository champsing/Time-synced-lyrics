<!doctype html>
<html lang="zh-TW">
    <head>
        <title>同步開唱：播放器</title>
        <link
            rel="icon"
            type="image/svg+xml"
            href="/public/og_image/music.webp"
        />
        <link rel="canonical" href="https://timesl.online/player/" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="精確同步歌詞到短語的網頁音樂播放器" />
        <meta property="og:locale" content="zh_TW" />
        <meta property="og:title" content="同步開唱：播放器" />
        <meta
            property="og:description"
            content="精確同步歌詞到短語的網頁音樂播放器"
        />
        <meta property="og:url" content="https://timesl.online/player/" />
        <meta property="og:site_name" content="時間同步歌詞" />
        <meta property="og:image" content="/public/og_image/music.webp" />
        <meta property="og:image:width" content="2048" />
        <meta property="og:image:height" content="2048" />
        <meta property="og:image:type" content="image/png" />
        <link rel="stylesheet" href="./styles/style.css" />
        <link rel="stylesheet" href="/styles/tailwind.css" />
        <link rel="preconnect" href="https://unpkg.com/" />
        <script type="importmap">
            {
                "imports": {
                    "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js"
                }
            }
        </script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet"
        />

        <link
            href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;1,700&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=content_copy"
        />

        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=arrow_back"
        />
    </head>

    <body
        class="bg-[#365456] text-white! min-h-screen m-0!"
        :style="{ backgroundColor: bodyBackgroundColor.value}"
    >
        <div id="app">
            <!-- 載入狀態 -->
            <div
                v-if="isLoading"
                id="loading-overlay"
                class="col-span-full text-center py-8 fixed inset-0 z-9999 bg-black/80 flex items-center justify-center flex-col"
            >
                <!-- SVG Spinner -->
                <svg
                    class="w-16 h-16 mb-6 animate-spin text-teal-400"
                    fill="none"
                    viewBox="0 0 24 24"
                >
                    <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                    ></circle>
                    <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8v8H4z"
                    ></path>
                </svg>

                <!-- 跳動文字 -->
                <div class="flex space-x-2 text-white text-3xl font-bold">
                    <span class="animate-bounce [animation-delay:50ms]">L</span>
                    <span class="animate-bounce [animation-delay:100ms]"
                        >O</span
                    >
                    <span class="animate-bounce [animation-delay:150ms]"
                        >A</span
                    >
                    <span class="animate-bounce [animation-delay:200ms]"
                        >D</span
                    >
                    <span class="animate-bounce [animation-delay:250ms]"
                        >I</span
                    >
                    <span class="animate-bounce [animation-delay:300ms]"
                        >N</span
                    >
                    <span class="animate-bounce [animation-delay:350ms]"
                        >G</span
                    >
                </div>

                <!-- 三點閃爍 -->
                <div class="flex space-x-1 mt-4">
                    <div
                        class="w-2 h-2 bg-white rounded-full animate-ping [animation-delay:0ms]"
                    ></div>
                    <div
                        class="w-2 h-2 bg-white rounded-full animate-ping [animation-delay:200ms]"
                    ></div>
                    <div
                        class="w-2 h-2 bg-white rounded-full animate-ping [animation-delay:400ms]"
                    ></div>
                </div>
            </div>

            <div
                v-if="isError"
                class="fixed inset-0 z-80 bg-[#1a1a1a] flex flex-col items-center justify-center px-6 text-center"
            >
                <div class="mb-6">
                    <span class="material-icons text-7xl text-rose-500"
                        >error_outline</span
                    >
                </div>
                <h2 class="text-3xl md:text-4xl font-bold mb-4 font-playfair">
                    抱歉，找不到播放內容
                </h2>
                <p class="text-gray-400 mb-8 max-w-md">{{ errorMessage }}</p>
                <a
                    href="/song-select"
                    class="bg-teal-600 hover:bg-teal-500 text-white px-8 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center gap-2"
                >
                    <span class="material-icons">library_music</span>
                    前往選歌系統
                </a>

                <a
                    href="/"
                    class="mt-6 text-sm text-gray-500 hover:text-teal-400 underline"
                >
                    回到首頁
                </a>
            </div>

            <!-- 導航欄 -->
            <nav v-if="!isError" class="shadow-sm">
                <div
                    class="top-0 fixed w-full px-4 py-2 z-50"
                    :style="{backgroundColor: bodyBackgroundColor}"
                >
                    <div
                        class="flex flex-row justify-between items-center w-full gap-2 sm:gap-0"
                    >
                        <div class="flex flex-row gap-3 md:ml-8">
                            <img
                                src="/public/og_image/music.webp"
                                alt="同步開唱"
                                aria-label="同步開唱"
                                class="w-8 h-8 md:w-10 md:h-10 rounded-xl"
                            />
                            <a href="/" aria-label="回首頁">
                                <h1
                                    class="text-2xl md:text-3xl font-bold text-black font-playfair mt-1"
                                    :class="{'text-rose-600': bodyBackgroundColor === '#101010'}"
                                >
                                    同步開唱
                                </h1>
                            </a>
                        </div>
                        <div class="grow"></div>
                        <div
                            id="song-select-sm"
                            class="sm:hidden bg-[#4ac2d7] outline-2 outline-cyan-800 rounded-md hover:bg-sky-300 transition-colors duration-200"
                        >
                            <a
                                href="/song-select"
                                title="返回選歌系統"
                                aria-label="返回選歌系統"
                            >
                                <svg
                                    height="50"
                                    width="50"
                                    viewBox="-143.36 -143.36 1310.72 1310.72"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="#000000"
                                >
                                    <g
                                        id="SVGRepo_bgCarrier"
                                        stroke-width="0"
                                    ></g>
                                    <g
                                        id="SVGRepo_tracerCarrier"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                    ></g>
                                    <g id="SVGRepo_iconCarrier">
                                        <path
                                            fill="#000000"
                                            d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z"
                                        ></path>
                                        <path
                                            fill="#000000"
                                            d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z"
                                        ></path>
                                    </g>
                                </svg>
                            </a>
                        </div>

                        <div
                            id="giticon-below-sm"
                            class="sm:hidden bg-[#4ac2d7] outline-2 outline-cyan-800 rounded-md hover:bg-sky-300 transition-colors duration-200"
                        >
                            <a
                                href="https://github.com/champsing/time-synced-lyrics"
                                target="_blank"
                                referrerpolicy="noreferrer noopener"
                                aria-label="這項專案的Repo"
                                title="GitHub"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    viewBox="-5 -5 75 75"
                                    height="50"
                                    width="50"
                                    aria-labelledby="title"
                                    aria-describedby="desc"
                                    role="img"
                                    xmlns:xlink="http://www.w3.org/1999/xlink"
                                >
                                    <title>Github</title>
                                    <desc>
                                        A solid styled icon from Orion Icon
                                        Library.
                                    </desc>
                                    <path fill="#374151"></path>
                                    <path
                                        data-name="layer2"
                                        d="M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z"
                                        fill="#202020"
                                    ></path>
                                    <path
                                        data-name="layer1"
                                        d="M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z"
                                        fill="#202020"
                                    ></path>
                                </svg>
                            </a>
                        </div>

                        <div
                            class="sm:flex sm:flex-row sm:gap-2 hidden text-right justify-end"
                        >
                            <div
                                id="song-select-sm"
                                class="bg-[#4ac2d7] outline-2 outline-cyan-800 rounded-4xl hover:bg-sky-300 transition-colors duration-200"
                            >
                                <a href="/song-select">
                                    <svg
                                        height="50"
                                        width="50"
                                        viewBox="-143.36 -143.36 1310.72 1310.72"
                                        xmlns="http://www.w3.org/2000/svg"
                                        fill="#000000"
                                    >
                                        <g
                                            id="SVGRepo_bgCarrier"
                                            stroke-width="0"
                                        ></g>
                                        <g
                                            id="SVGRepo_tracerCarrier"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        ></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <path
                                                fill="#000000"
                                                d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z"
                                            ></path>
                                            <path
                                                fill="#000000"
                                                d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z"
                                            ></path>
                                        </g>
                                    </svg>
                                </a>
                            </div>

                            <div
                                id="giticon-sm"
                                class="bg-[#4ac2d7] outline-2 outline-cyan-800 rounded-2xl hover:bg-sky-300 transition-colors duration-200"
                            >
                                <a
                                    href="https://github.com/champsing/time-synced-lyrics"
                                    target="_blank"
                                    referrerpolicy="noreferrer noopener"
                                    aria-label="這項專案的Repo"
                                    title="GitHub"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 -5 64 64"
                                        height="40"
                                        width="50"
                                        aria-labelledby="title"
                                        aria-describedby="desc"
                                        role="img"
                                        xmlns:xlink="http://www.w3.org/1999/xlink"
                                    >
                                        <title>Github</title>
                                        <desc>
                                            A solid styled icon from Orion Icon
                                            Library.
                                        </desc>
                                        <path fill="#374151"></path>
                                        <path
                                            data-name="layer2"
                                            d="M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z"
                                            fill="#202020"
                                        ></path>
                                        <path
                                            data-name="layer1"
                                            d="M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z"
                                            fill="#202020"
                                        ></path>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- 左側主要顯示區域 -->
            <div
                v-if="!isError && !isLoading"
                id="main-display-section"
                class="md:flex flex-col items-center md:w-[68%] md:ml-8 px-4 mt-20"
            >
                <!-- 歌詞容器 -->
                <div
                    id="lyrics-container"
                    class="scroll-smooth snap-y snap-proximity text-center p-4 w-full relative mb-[30vh] md:mb-10"
                    :class="{ 'bg-[#3b3a3a]': !enableLyricBackground }"
                >
                    <div
                        class="md:h-svh md:overflow-scroll md:overflow-x-hidden"
                        style="scrollbar-width: none"
                    >
                        <div
                            v-for="(line, index) in jsonMappingContent"
                            class="lyric-line m-6! opacity-100"
                            :id="`lyric-line-${index}`"
                            :class="{ 'is-duet': currentSong.is_duet, 'is-secondary-vocalist': line.is_secondary, 'is-together': line.is_together }"
                        >
                            <button
                                :id="`line-button-${index}`"
                                @click="jumpToCurrentLine(index)"
                                class="lyric-button text-2xl bg-transparent p-0 cursor-pointer max-w-[50%]"
                                type="button"
                                :class="{ 'active': isCurrentLine(index) }"
                            >
                                <!-- [for debugging] show line index -->
                                <!-- {{ index }} -->
                                <div class="primary-vocals">
                                    <span
                                        v-for="(t, phraseIndex) in line.text"
                                        :key="phraseIndex"
                                        :id="`lyric-phrase-${index}-${phraseIndex}`"
                                        class="lyric-phrase"
                                        :duration="line.duration[phraseIndex] * 100"
                                        :delay="line.delay[phraseIndex] * 100"
                                        :style="getPhraseStyle(index, phraseIndex)"
                                        :class="{ 'active': isActivePhrase(currentTime, line, phraseIndex) && index < jsonMappingContent.length - 1, 'kiai': isKiai(line, phraseIndex) }"
                                    >
                                        <span v-if="t.pronounciation">
                                            <span v-if="t.pncat_forced">
                                                <ruby>
                                                    {{ t.phrase }}
                                                    <rp>(</rp>
                                                    <rt class="text-rose-400"
                                                        >{{ t.pronounciation
                                                        }}</rt
                                                    >
                                                    <rp>)</rp>
                                                </ruby>
                                            </span>
                                            <span
                                                v-else-if="enablePronounciation"
                                            >
                                                <ruby>
                                                    {{ t.phrase }}
                                                    <rp>(</rp>
                                                    <rt
                                                        >{{ t.pronounciation
                                                        }}</rt
                                                    >
                                                    <rp>)</rp>
                                                </ruby>
                                            </span>
                                            <span v-else>{{ t.phrase }}</span>
                                        </span>
                                        <span v-else>{{ t.phrase }}</span>
                                    </span>
                                </div>

                                <div
                                    v-if="line.background_voice !== undefined"
                                    class="background-vocals"
                                >
                                    <span
                                        v-for="(bvt, phraseIndex) in line.background_voice.text"
                                        v-if="isCurrentLine(index)"
                                        :key="phraseIndex"
                                        class="lyric-phrase text-lg"
                                        :duration="line.duration[phraseIndex] * 100"
                                        :delay="line.delay[phraseIndex] * 100"
                                        :style="getBackgroundPhraseStyle(index, phraseIndex)"
                                        :class="{ 'active': isActivePhrase(currentTime, line.background_voice, phraseIndex)  && index < jsonMappingContent.length - 1, 'kiai': isBackgroundKiai(line, phraseIndex) }"
                                    >
                                        <span v-if="bvt.pronounciation">
                                            <span v-if="bvt.pncat_forced">
                                                <ruby>
                                                    {{ bvt.phrase }}
                                                    <rp>(</rp>
                                                    <rt class="text-rose-400"
                                                        >{{ bvt.pronounciation
                                                        }}</rt
                                                    >
                                                    <rp>)</rp>
                                                </ruby>
                                            </span>
                                            <span
                                                v-else-if="enablePronounciation"
                                            >
                                                <ruby>
                                                    {{ bvt.phrase }}
                                                    <rp>(</rp>
                                                    <rt
                                                        >{{ bvt.pronounciation
                                                        }}</rt
                                                    >
                                                    <rp>)</rp>
                                                </ruby>
                                            </span>
                                            <span v-else>{{ bvt.phrase }}</span>
                                        </span>
                                        <span v-else>{{ bvt.phrase }}</span>
                                    </span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div
                        class="absolute inset-0 -z-10 overflow-hidden rounded-2xl select-none"
                        v-if="enableLyricBackground"
                    >
                        <img
                            :src="currentSong.art"
                            :alt="currentSong.folder"
                            class="reflection-scan w-full h-full object-cover opacity-50 brightness-50 blur-xl animate-background relative overflow-hidden translate-z-0 backface-hidden"
                        />
                    </div>
                    <!-- 電腦版翻譯置於歌詞框下方正中 -->
                    <div v-if="enableTranslation" class="md:h-[10vh] h-0"></div>
                </div>

                <div
                    id="translation-container"
                    v-if="enableTranslation"
                    class="hidden md:block fixed bottom-0 mb-4 px-4"
                >
                    <div
                        v-if="currentSong.translation?.available == true"
                        class="p-4 flex flex-col items-center gap-2 bg-[#231f1f] opacity-90 rounded-xl w-max"
                    >
                        <div
                            class="text-2xl font-bold text-center text-teal-300 p-2"
                        >
                            {{ translationText }}
                            <div
                                class="mt-1 text-base text-center text-teal-500"
                            >
                                {{ backgroundTranslationText }}
                            </div>
                        </div>

                        <div class="mt-2">
                            <div v-if="currentSong.translation?.cite">
                                <a
                                    :href="currentSong.translation?.cite"
                                    title="翻譯作者姓名"
                                    aria-label="翻譯作者姓名"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="text-xs font-bold text-center text-green-400 underline md:no-underline md:hover:underline"
                                >
                                    翻譯作者：{{ translationAuthor }}
                                </a>
                            </div>
                            <div
                                id="translate-author-without-link"
                                class="opacity-100"
                                v-else
                            >
                                翻譯作者：{{ translationAuthor }}
                            </div>
                        </div>
                    </div>
                    <div
                        v-else
                        class="p-4 flex flex-col items-center gap-2 bg-[#231f1f] opacity-80 rounded-xl w-fit"
                    >
                        <span>本歌曲尚未提供翻譯</span>
                    </div>
                </div>
            </div>

            <!-- 主要 UI 區域 -->
            <div
                id="main-ui-section"
                class="fixed bottom-0 right-0 w-full md:w-100 p-4 md:pl-0 z-50 transition-all duration-300"
            >
                <!-- 桌面端收合按鈕 (簡化為純圖示) -->
                <div class="hidden md:flex justify-end mb-2">
                    <button
                        id="controller-panel-switch-md"
                        class="p-2 bg-white/10 hover:bg-white/20 backdrop-blur-md rounded-full text-white transition-all shadow-lg border border-white/10"
                        title="顯示/隱藏介面"
                    >
                        <span
                            class="material-icons block transition-transform duration-300"
                            id="controller-panel-switch-icon-md"
                            >expand_more</span
                        >
                    </button>
                </div>

                <!-- 主控制面板 -->
                <div
                    id="controller-panel"
                    class="bg-[#1a1a1a]/80 backdrop-blur-xl rounded-[28px] border border-white/10 shadow-2xl overflow-hidden transition-all"
                >
                    <!-- 歌曲資訊區塊 -->
                    <div class="p-5 flex flex-col gap-4">
                        <div class="flex items-start justify-between">
                            <div class="flex-1 min-w-0">
                                <h2
                                    class="text-white text-xl md:text-2xl font-bold truncate tracking-tight"
                                >
                                    {{ currentSong.title || currentSong.folder
                                    }}
                                </h2>
                                <div class="flex items-center gap-2 mt-1">
                                    <button
                                        v-if="currentSong.credits"
                                        id="credit-btn"
                                        class="text-white/60 hover:text-white text-sm transition-colors truncate underline underline-offset-4 md:no-underline"
                                    >
                                        {{ currentSong.displayArtist ||
                                        "未知藝人" }}
                                    </button>
                                    <span
                                        v-else
                                        class="text-white/40 text-sm truncate underline underline-offset-4 md:no-underline"
                                        >{{ currentSong.displayArtist ||
                                        "未知藝人" }}</span
                                    >
                                    <span class="text-white/20 text-xs">•</span>
                                    <span class="text-white/40 text-xs truncate"
                                        >{{ currentSong.album?.name || "單曲"
                                        }}</span
                                    >
                                </div>
                            </div>

                            <!-- 快速動作按鈕 (取代原本的大按鈕) -->
                            <div class="flex gap-1 ml-2">
                                <button
                                    id="share-btn"
                                    class="p-2 text-white/60 hover:text-white hover:bg-white/10 rounded-full transition-all"
                                >
                                    <span class="material-icons text-xl"
                                        >share</span
                                    >
                                </button>
                                <button
                                    id="setting-btn"
                                    class="p-2 text-white/60 hover:text-white hover:bg-white/10 rounded-full transition-all"
                                >
                                    <span class="material-icons text-xl"
                                        >settings</span
                                    >
                                </button>
                            </div>
                        </div>

                        <!-- 副標題 (如果有) -->
                        <p
                            v-if="currentSong.subtitle"
                            class="text-white/40 text-xs line-clamp-2 italic"
                        >
                            {{ parseSubtitle(currentSong.subtitle) }}
                        </p>
                    </div>

                    <!-- 播放控制區 -->
                    <div class="px-5 pb-6 flex flex-col gap-5">
                        <!-- 進度條與時間 -->
                        <div class="flex flex-col gap-2">
                            <div
                                id="player"
                                class="w-0 h-0 md:w-full md:h-full bg-white/10 rounded-3xl relative group cursor-pointer"
                            ></div>
                            <div class="flex justify-between items-center px-1">
                                <span
                                    class="text-[10px] font-mono text-white/40 tracking-tighter"
                                    >{{ formattedCurrentTime }}</span
                                >
                                <!-- 版本徽章區 (更精緻的標籤) -->
                                <div
                                    v-if="songVersion !== ORIGINAL"
                                    class="flex flex-wrap gap-2"
                                >
                                    <span
                                        v-if="songVersion == INSTRUMENTAL"
                                        class="px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-[10px] font-bold rounded-md border border-cyan-500/30 uppercase tracking-wider"
                                        >Instrumental</span
                                    >
                                    <span
                                        v-if="songVersion == THE_FIRST_TAKE"
                                        class="px-2 py-0.5 bg-white/10 text-white text-[10px] font-bold rounded-md border border-white/20 uppercase tracking-wider"
                                        >The First Take</span
                                    >
                                    <span
                                        v-if="songVersion == LIVE"
                                        class="px-2 py-0.5 bg-rose-500/20 text-rose-400 text-[10px] font-bold rounded-md border border-rose-500/30 uppercase tracking-wider"
                                        >Live</span
                                    >
                                </div>
                                <span
                                    class="text-[10px] font-mono text-white/40 tracking-tighter"
                                    >{{ formattedSongDuration }}</span
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 手機端翻譯顯示 (改為懸浮簡潔樣式) -->
                <div
                    id="translation-container-below-md"
                    v-if="enableTranslation"
                    class="md:hidden mt-2"
                >
                    <div
                        class="p-3 bg-black/60 backdrop-blur-lg rounded-2xl border border-white/10 text-center"
                    >
                        <div v-if="currentSong.translation?.available">
                            <p class="text-teal-300 font-medium leading-tight">
                                {{ translationText }}
                            </p>
                            <p class="text-teal-500/80 text-xs mt-1">
                                {{ backgroundTranslationText }}
                            </p>
                            <div class="mt-2" v-if="translationAuthor">
                                <a
                                    :href="currentSong.translation?.cite"
                                    class="text-[10px] text-white/40 hover:text-white/60 transition-colors"
                                >
                                    翻譯作者：{{ translationAuthor }}
                                </a>
                            </div>
                        </div>
                        <div
                            v-else
                            class="text-[10px] text-white/40 hover:text-white/60 transition-colors"
                        >
                            <span>本歌曲尚未提供翻譯</span>
                            <button id="fast-close-translation" class="underline ml-4" @click="enableTranslation = false">
                                關閉翻譯
                            </button>
                        </div>
                    </div>
                </div>

                <div
                    id="controller-panel"
                    class="p-4 mt-2 bg-[#1a1a1a]/80 backdrop-blur-xl rounded-[28px] border border-white/10 shadow-2xl overflow-hidden transition-all"
                >
                    <!-- 主控制按鈕組 -->
                    <div class="flex items-center justify-between">
                        <!-- 音量控制 (簡化) -->
                        <div class="group relative flex items-center">
                            <button
                                @click="toggleMute()"
                                class="text-white/60 hover:text-white transition-colors"
                            >
                                <span class="material-icons"
                                    >{{ (volume == 0 || isMuted) ? 'volume_off'
                                    : 'volume_up' }}</span
                                >
                            </button>

                            <div
                                class="hidden md:flex ml-2 w-0 overflow-hidden group-hover:w-40 transition-all duration-300 ease-out items-center"
                            >
                                <input
                                    type="range"
                                    min="0"
                                    max="100"
                                    v-model="volume"
                                    class="w-full h-1 bg-white/20 rounded-full appearance-none accent-white cursor-pointer py-3 mx-2"
                                    @input="changeVolume($event.target.value)"
                                />
                                <span class="p-1">{{ volume || 70 }}</span>
                            </div>
                        </div>

                        <!-- 播放核心按鈕 -->
                        <div class="flex items-center gap-10">
                            <button
                                @click="rewind10Sec()"
                                class="text-white/60 hover:text-white transition-all transform active:scale-90"
                            >
                                <span class="material-icons text-2xl"
                                    >replay_10</span
                                >
                            </button>

                            <button
                                @click="isPaused ? playVideo() : pauseVideo()"
                                class="w-14 h-14 flex items-center justify-center bg-white text-black rounded-full shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:scale-105 active:scale-95 transition-all"
                            >
                                <span class="material-icons text-4xl"
                                    >{{ isPaused ? 'play_arrow' : 'pause'
                                    }}</span
                                >
                            </button>

                            <button
                                @click="moveForward10Sec()"
                                class="text-white/60 hover:text-white transition-all transform active:scale-90"
                            >
                                <span class="material-icons text-2xl"
                                    >forward_10</span
                                >
                            </button>
                        </div>

                        <!-- 額外功能: 關於 (原本隱藏在設定中，現在可以放在這) -->
                        <button
                            id="about-btn"
                            class="text-white/40 hover:text-white/80 transition-colors"
                        >
                            <span class="material-icons">info</span>
                        </button>
                    </div>
                    <!-- 手機版音量滑桿 -->
                    <div
                        class="flex md:hidden group-hover:w-40 transition-all duration-300 ease-out items-center mt-2"
                    >
                        <input
                            type="range"
                            min="0"
                            max="100"
                            v-model="volume"
                            class="w-full h-1 bg-white/20 rounded-full appearance-none accent-white cursor-pointer py-3 mx-2"
                            @input="changeVolume($event.target.value)"
                        />
                        <span class="p-1">{{ volume || 70 }}</span>
                    </div>
                </div>

                <!-- 手機端收合切換 -->
                <div class="md:hidden mt-2 flex justify-center">
                    <button
                        id="controller-panel-switch-below-md"
                        class="px-4 py-1.5 bg-black/40 backdrop-blur-md rounded-full text-white/60 text-[10px] uppercase tracking-[0.2em] font-bold border border-white/5"
                    >
                        <div class="flex items-center gap-1">
                            <span
                                class="material-icons text-sm"
                                id="controller-panel-switch-icon-below-md"
                                >keyboard_arrow_down</span
                            >
                            <span id="controller-panel-switch-state-below-md"
                                >CLOSE</span
                            >
                        </div>
                    </button>
                </div>
            </div>

            <!-- 所有模態框整理到這裡 -->
            <div id="modals-container">
                <!-- 設定 -->
                <div id="setting-modal-container" class="hidden">
                    <div id="setting-modal-mask" class="modal-mask"></div>
                    <!-- Modal content -->
                    <div
                        id="setting-modal-content"
                        class="modal-mutual bg-[#455a47] top-2/5 left-[10%] w-4/5 md:left-[30%] md:top-[30%] md:w-2/5"
                    >
                        <div class="flex flex-row">
                            <span class="modal-name">設定</span>
                            <div class="grow"></div>
                            <span
                                class="close"
                                id="setting-modal-close-btn"
                                title="關閉"
                                aria-label="關閉視窗"
                                >&times;</span
                            >
                        </div>

                        <div class="modal-view-area custom-scrollbar">
                            <div
                                id="change-body-background-container"
                                class="settings-entry"
                            >
                                <label id="change-body-background"
                                    >背景顏色：</label
                                >
                                <div
                                    id="change-body-background"
                                    class="color-picker inline-block"
                                >
                                    <details class="dropdown relative">
                                        <summary
                                            class="dropdown-trigger flex items-center gap-2 p-2 px-3 border border-gray-300 rounded cursor-pointer hover:bg-gray-50"
                                        >
                                            <span
                                                class="color-preview w-5 h-5 border border-gray-200 rounded-sm"
                                                :style="{ backgroundColor: bodyBackgroundColor }"
                                            ></span>
                                            <span class="text-sm font-mono"
                                                >{{ bgColorName }}</span
                                            >
                                        </summary>
                                        <div
                                            class="dropdown-menu absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded shadow-md z-50 p-2 w-max"
                                        >
                                            <div
                                                class="color-grid grid grid-cols-5 gap-1"
                                            >
                                                <button
                                                    v-for="(colorObj, index) in colorOptions"
                                                    :key="index"
                                                    type="button"
                                                    class="color-square w-7 h-7 border border-gray-200 rounded cursor-pointer duration-200 transition-transform hover:scale-110 focus:outline-none"
                                                    :class="{ 'border-2 border-gray-800 ring-1 ring-gray-300': bodyBackgroundColor === colorObj.color }"
                                                    :style="{ backgroundColor: colorObj.color }"
                                                    @click="bodyBackgroundColor = colorObj.color"
                                                    :title="color"
                                                    :aria-label="color"
                                                ></button>
                                            </div>
                                        </div>
                                    </details>
                                </div>
                                <br />
                            </div>
                            <div
                                id="enable-background-container"
                                class="settings-entry"
                            >
                                <label class="switch mr-2">
                                    <input
                                        type="checkbox"
                                        id="enable-background"
                                        v-model="enableLyricBackground"
                                    />
                                    <span class="slider round"></span>
                                </label>
                                <label id="enable-background"
                                    >開啟歌詞背景</label
                                ><br />
                            </div>
                            <div
                                id="enable-scroll-to-current-line-container"
                                class="settings-entry"
                            >
                                <label class="switch mr-1">
                                    <input
                                        type="checkbox"
                                        id="enable-scroll-to-current-line"
                                        v-model="scrollToCurrentLine"
                                    />
                                    <span class="slider round"></span>
                                </label>
                                <label id="enable-scroll-to-current-line"
                                    >自動滾動到當前行</label
                                ><br />
                            </div>
                            <div
                                id="enable-translation-container"
                                class="settings-entry"
                            >
                                <label class="switch mr-2">
                                    <input
                                        type="checkbox"
                                        id="enable-translation"
                                        v-model="enableTranslation"
                                    />
                                    <span class="slider round"></span>
                                </label>
                                <label id="enable-translation">開啟翻譯</label
                                ><br />
                            </div>
                            <div
                                id="enable-pronounciation-container"
                                class="settings-entry"
                            >
                                <label class="switch mr-2">
                                    <input
                                        type="checkbox"
                                        id="enable-pronounciation"
                                        :disabled="!currentSong.furigana"
                                        v-model="enablePronounciation"
                                    />
                                    <span class="slider round"></span>
                                </label>
                                <label id="enable-pronounciation"
                                    >顯示假名讀音（僅部分歌曲可用）</label
                                ><br />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 工作人員名單 -->
                <div id="credit-modal-container" class="hidden">
                    <div id="credit-modal-mask" class="modal-mask"></div>
                    <!-- Modal content -->
                    <div
                        id="credit-modal-content"
                        class="modal-mutual bg-[#2c4f3d] left-[10%] top-1/5 w-4/5 md:left-[30%] md:w-2/5"
                    >
                        <div class="flex flex-row">
                            <span class="modal-name">工作人員名單</span>
                            <div class="grow"></div>
                            <span
                                class="close"
                                id="credit-modal-close-btn"
                                title="關閉"
                                aria-label="關閉視窗"
                                >&times;</span
                            >
                        </div>
                        <div id="artist-banner" class="text-center">
                            <span id="artist">演出藝人</span>
                            <div class="text-2xl font-bold">
                                {{ currentSong.displayArtist || "未知的藝人" }}
                            </div>
                        </div>

                        <hr class="m-4" />

                        <div class="text-center items-center mr-2 mb-2">
                            <span id="collection-album">收錄專輯：</span>
                            <div
                                class="inline p-1.5 md:p-2 rounded-xl font-poppins underline md:no-underline md:hover:underline text-sm text-wrap bg-[#2cc3b9]"
                            >
                                <a
                                    :href="ALBUM_GOOGLE_LINK_BASE + currentSong.album.link"
                                    v-if="currentSong.album?.link !== undefined"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    title="專輯名稱"
                                    aria-label="專輯名稱"
                                >
                                    {{ currentSong.album?
                                    currentSong.album?.name : currentSong.title
                                    + " - 單曲" }}
                                </a>
                                <span v-else>
                                    {{ currentSong.album? currentSong.album.name
                                    : currentSong.title + " - 單曲" }}
                                </span>
                            </div>
                        </div>

                        <div
                            class="pr-4 custom-scrollbar whitespace-pre-wrap grid grid-row-3 md:grid-cols-3 gap-y-6 overflow-y-scroll max-h-70 font-poppins"
                            v-if="currentSong.credits"
                        >
                            <!-- 演職員名單 需要可以再加 -->
                            <div
                                class="credit-list-contribution-type-name"
                                v-if="currentSong.credits.performance"
                            >
                                表演者
                            </div>
                            <div
                                :id="`performance-contributors-${index + 1}`"
                                class="flex flex-col gap-2 text-center"
                                v-for="(contributor, index) in currentSong.credits.performance"
                            >
                                <div
                                    :id="'contributor' + index"
                                    class="text-xl font-bold"
                                >
                                    {{ contributor.name }}
                                </div>
                                <span
                                    :id="'contribution' + index"
                                    class="text-slate-300"
                                >
                                    {{ contributor.contribution?.join("、") }}
                                </span>
                            </div>
                            <div
                                class="credit-list-contribution-type-name"
                                v-if="currentSong.credits.song_writing"
                            >
                                詞曲
                            </div>
                            <div
                                :id="`song-writing-contributors-${index + 1}`"
                                class="flex flex-col gap-2 text-center"
                                v-for="(contributor, index) in currentSong.credits.song_writing"
                            >
                                <div
                                    :id="'contributor' + index"
                                    class="text-xl font-bold"
                                >
                                    {{ contributor.name }}
                                </div>
                                <span
                                    :id="'contribution' + index"
                                    class="text-slate-300"
                                >
                                    {{ contributor.contribution?.join("、") }}
                                </span>
                            </div>
                            <div
                                class="credit-list-contribution-type-name"
                                v-if="currentSong.credits.engineering"
                            >
                                製作與工程團隊
                            </div>
                            <div
                                :id="`engineering-contributors-${index + 1}`"
                                class="flex flex-col gap-2 text-center"
                                v-for="(contributor, index) in currentSong.credits.engineering"
                            >
                                <div
                                    :id="'contributor' + index"
                                    class="text-xl font-bold"
                                >
                                    {{ contributor.name }}
                                </div>
                                <span
                                    :id="'contribution' + index"
                                    class="text-slate-300"
                                >
                                    {{ contributor.contribution?.join("、") }}
                                </span>
                            </div>
                        </div>

                        <hr class="mt-4" />
                        <span class="text-xs text-gray-400 text-wrap"
                            >工作人員名單僅供參考，本站並不保證該名單 100%
                            正確或樂曲之製作必然為本工作人員名單所提供的分工。</span
                        >
                    </div>
                </div>

                <!-- 分享歌曲 -->
                <div id="share-modal-container" class="hidden">
                    <div id="share-modal-mask" class="modal-mask"></div>
                    <!-- Modal content -->
                    <div
                        id="share-modal-content"
                        class="modal-mutual bg-amber-900 left-[10%] top-2/5 w-4/5 md:left-[20%] md:top-[30%] md:w-3/5"
                    >
                        <div class="flex flex-row">
                            <span class="modal-name">分享</span>
                            <div class="grow"></div>
                            <span
                                class="close"
                                id="share-modal-close-btn"
                                title="關閉"
                                aria-label="關閉視窗"
                                >&times;</span
                            >
                        </div>
                        <div class="modal-view-area custom-scrollbar">
                            <div class="flex flex-row gap-4">
                                <span class="material-icons p-2">link</span>
                                <div class="flex flex-row gap-2">
                                    <textarea
                                        id="song-link"
                                        name="song-link"
                                        class="resize-none h-8 w-4/5 lg:w-fit border-2 whitespace-nowrap mt-1"
                                        readonly
                                        rows="1"
                                        cols="80"
                                        wrap="off"
                                    >
                                    {{ currentSongURI }}
                                    </textarea>
                                    <button
                                        id="copy-link"
                                        title="複製連結"
                                        aria-label="複製連結"
                                        class="outline rounded-2xl w-1/5 m-1"
                                        @click="copyToClipboard(currentSongURI, '歌曲連結')"
                                    >
                                        <div class="sm:hidden">
                                            <span class="material-icons"
                                                >content_copy</span
                                            >
                                        </div>
                                        <span
                                            class="hidden sm:flex flex-row gap-2 justify-center"
                                        >
                                            <span class="material-icons"
                                                >content_copy</span
                                            >
                                            複製
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 關於 -->
                <div id="about-modal-container" class="hidden">
                    <div id="about-modal-mask" class="modal-mask"></div>
                    <!-- Modal content -->
                    <div
                        id="about-modal-content"
                        class="modal-mutual bg-[#545425] left-[10%] top-2/5 w-4/5 md:left-[30%] md:top-[30%] md:w-2/5"
                    >
                        <div class="flex flex-row">
                            <span class="modal-name">關於</span>
                            <div class="grow"></div>
                            <span
                                class="close"
                                id="about-modal-close-btn"
                                title="關閉"
                                aria-label="關閉視窗"
                                >&times;</span
                            >
                        </div>

                        <div class="flex flex-col gap-4 items-center">
                            <div class="flex flex-col">
                                <div id="champsing-banner" class="text-center">
                                    <span id="champsing">網站作者</span>
                                    <div class="text-2xl font-bold">
                                        香榭 Champsing
                                    </div>
                                </div>
                            </div>

                            <div
                                id="debug-info"
                                class="custom-scrollbar overflow-y-scroll max-h-20 font-poppins"
                            >
                                <div class="m-4">
                                    <div id="version">播放器版本：</div>
                                    <div id="playback-id">播放 ID：</div>
                                </div>
                            </div>
                            <div
                                id="copy-debug-info"
                                class="text-center rounded-md bg-[#1d94a1] px-4 py-2 text-sm font-semibold text-white duration-300 ease-in-out hover:scale-125 w-40"
                            >
                                <button
                                    type="button"
                                    id="copy-debug-info-btn"
                                    aria-label="複製偵錯資訊"
                                >
                                    <span class="text-center"
                                        >複製偵錯資訊</span
                                    >
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="/web/player.js" type="module"></script>
    </body>
</html>
